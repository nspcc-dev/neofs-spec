<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="487px" preserveAspectRatio="none" style="width:860px;height:487px;" version="1.1" viewBox="0 0 860 487" width="860px" zoomAndPan="magnify"><defs><filter height="300%" id="f14cz1mxrv74hi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f14cz1mxrv74hi)" height="116.3984" style="stroke: #000000; stroke-width: 2.0;" width="400" x="13" y="71.5938"/><rect fill="#FFFFFF" filter="url(#f14cz1mxrv74hi)" height="174.6641" style="stroke: #000000; stroke-width: 2.0;" width="746" x="95" y="201.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="54.5938" y2="159.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="159.9922" y2="187.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="187.9922" y2="348.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="348.6563" y2="376.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="376.6563" y2="422.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="142" y1="54.5938" y2="159.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="142" x2="142" y1="159.9922" y2="187.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="142" y1="187.9922" y2="348.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="142" x2="142" y1="348.6563" y2="376.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="142" y1="376.6563" y2="422.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276.5" x2="276.5" y1="54.5938" y2="159.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="276.5" x2="276.5" y1="159.9922" y2="187.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276.5" x2="276.5" y1="187.9922" y2="348.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="276.5" x2="276.5" y1="348.6563" y2="376.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276.5" x2="276.5" y1="376.6563" y2="422.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="408" y1="54.5938" y2="159.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="408" x2="408" y1="159.9922" y2="187.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="408" y1="187.9922" y2="348.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="408" x2="408" y1="348.6563" y2="376.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="408" y1="376.6563" y2="422.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599.5" x2="599.5" y1="54.5938" y2="159.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="599.5" x2="599.5" y1="159.9922" y2="187.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599.5" x2="599.5" y1="187.9922" y2="348.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="599.5" x2="599.5" y1="348.6563" y2="376.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599.5" x2="599.5" y1="376.6563" y2="422.7891"/><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="22.9951">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="39.292">nodes</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="441.7842">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="458.0811">nodes</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="105" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="113.5" y="22.9951">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="112" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="105" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="113.5" y="441.7842">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="112" y="458.0811">contract</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="234.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="241.5" y="22.9951">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="246.5" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="234.5" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="241.5" y="441.7842">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="246.5" y="458.0811">contract</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="364" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="371" y="22.9951">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="383.5" y="39.292">Nodes</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="364" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="371" y="441.7842">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="383.5" y="458.0811">Nodes</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="562.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="570.5" y="22.9951">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="569.5" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f14cz1mxrv74hi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="562.5" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="570.5" y="441.7842">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="569.5" y="458.0811">contract</text><path d="M13,71.5938 L370,71.5938 L370,78.5938 L360,88.5938 L13,88.5938 L13,71.5938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="116.3984" style="stroke: #000000; stroke-width: 2.0;" width="400" x="13" y="71.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="312" x="28" y="84.6606">every 1\3 of epoch (including epoch start)</text><polygon fill="#A80036" points="265,105.8594,275,109.8594,265,113.8594,269,109.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="271" y1="109.8594" y2="109.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="66" y="104.7935">Reporting actual storage state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="277" x2="319" y1="138.9922" y2="138.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319" x2="319" y1="138.9922" y2="151.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278" x2="319" y1="151.9922" y2="151.9922"/><polygon fill="#A80036" points="288,147.9922,278,151.9922,288,155.9922,284,151.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="284" y="133.9263">Normalizes values</text><path d="M95,201.9922 L233,201.9922 L233,208.9922 L223,218.9922 L95,218.9922 L95,201.9922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="174.6641" style="stroke: #000000; stroke-width: 2.0;" width="746" x="95" y="201.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="110" y="215.0591">1\2 of epoch</text><polygon fill="#A80036" points="588,236.2578,598,240.2578,588,244.2578,592,240.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="594" y1="240.2578" y2="240.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="415" y="235.1919">Pay for &lt;cid&gt; container tx</text><polygon fill="#A80036" points="153.5,265.3906,143.5,269.3906,153.5,273.3906,149.5,269.3906" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="588,265.3906,598,269.3906,588,273.3906,592,269.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147.5" x2="594" y1="269.3906" y2="269.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="159.5" y="264.3247">Request basic income rate</text><polygon fill="#A80036" points="288,294.5234,278,298.5234,288,302.5234,284,298.5234" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="588,294.5234,598,298.5234,588,302.5234,592,298.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282" x2="594" y1="298.5234" y2="298.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="294" y="293.4575">Request billing info for &lt;cid&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="600" x2="642" y1="327.6563" y2="327.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="642" x2="642" y1="327.6563" y2="340.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="642" y1="340.6563" y2="340.6563"/><polygon fill="#A80036" points="611,336.6563,601,340.6563,611,344.6563,607,340.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="607" y="322.5903">Transfer requested amount to SNs</text><polygon fill="#A80036" points="153.5,400.7891,143.5,404.7891,153.5,408.7891,149.5,404.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147.5" x2="407" y1="404.7891" y2="404.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="159.5" y="399.7231">New epoch</text><!--MD5=[1d2d55556900d4e018b3810f500d5f7b]
@startuml
participant "Storage\nnodes" as sn
participant "Netmap\ncontract" as netmap
participant "Container\ncontract" as cnr
participant "Inner Ring\nNodes" as ir
participant "Balance\ncontract" as bln

group every 1\3 of epoch (including epoch start)
sn -> cnr: Reporting actual storage state
cnr -> cnr: Normalizes values
...
end

group 1\2 of epoch
ir -> bln: Pay for <cid> container tx
bln <-> netmap: Request basic income rate
bln <-> cnr: Request billing info for <cid>
bln -> bln: Transfer requested amount to SNs
...
end

ir -> netmap: New epoch
@enduml

PlantUML version 1.2020.15(Sun Jun 28 11:39:45 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>