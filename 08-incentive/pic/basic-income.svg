<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="701px" preserveAspectRatio="none" style="width:693px;height:701px;" version="1.1" viewBox="0 0 693 701" width="693px" zoomAndPan="magnify"><defs><filter height="300%" id="f7u31ufo9hs1j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="261.6406" style="stroke: #000000; stroke-width: 2.0;" width="441.5" x="13" y="101.0469"/><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="103.7031" style="stroke: #000000; stroke-width: 2.0;" width="446" x="236.5" y="376.6875"/><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="103.7031" style="stroke: #000000; stroke-width: 2.0;" width="329" x="353.5" y="494.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="58" y1="54.8125" y2="218.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="58" x2="58" y1="218.9844" y2="246.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="58" y1="246.9844" y2="334.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="58" x2="58" y1="334.6875" y2="362.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="58" y1="362.6875" y2="452.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="58" x2="58" y1="452.3906" y2="480.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="58" y1="480.3906" y2="570.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="58" x2="58" y1="570.0938" y2="598.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="58" y1="598.0938" y2="644.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198.5" x2="198.5" y1="54.8125" y2="218.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="198.5" x2="198.5" y1="218.9844" y2="246.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198.5" x2="198.5" y1="246.9844" y2="334.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="198.5" x2="198.5" y1="334.6875" y2="362.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198.5" x2="198.5" y1="362.6875" y2="452.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="198.5" x2="198.5" y1="452.3906" y2="480.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198.5" x2="198.5" y1="480.3906" y2="570.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="198.5" x2="198.5" y1="570.0938" y2="598.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198.5" x2="198.5" y1="598.0938" y2="644.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="54.8125" y2="218.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="286.5" x2="286.5" y1="218.9844" y2="246.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="246.9844" y2="334.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="286.5" x2="286.5" y1="334.6875" y2="362.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="362.6875" y2="452.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="286.5" x2="286.5" y1="452.3906" y2="480.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="480.3906" y2="570.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="286.5" x2="286.5" y1="570.0938" y2="598.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="598.0938" y2="644.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="403.5" y1="54.8125" y2="218.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="403.5" x2="403.5" y1="218.9844" y2="246.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="403.5" y1="246.9844" y2="334.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="403.5" x2="403.5" y1="334.6875" y2="362.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="403.5" y1="362.6875" y2="452.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="403.5" x2="403.5" y1="452.3906" y2="480.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="403.5" y1="480.3906" y2="570.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="403.5" x2="403.5" y1="570.0938" y2="598.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="403.5" y1="598.0938" y2="644.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="634.5" y1="54.8125" y2="218.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="634.5" x2="634.5" y1="218.9844" y2="246.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="634.5" y1="246.9844" y2="334.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="634.5" x2="634.5" y1="334.6875" y2="362.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="634.5" y1="362.6875" y2="452.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="634.5" x2="634.5" y1="452.3906" y2="480.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="634.5" y1="480.3906" y2="570.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="634.5" x2="634.5" y1="570.0938" y2="598.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="634.5" y1="598.0938" y2="644.3281"/><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="30" y="22.9883">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="36" y="39.3945">nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="23" y="643.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="30" y="663.3164">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="36" y="679.7227">nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="161.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="171" y="22.9883">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="168.5" y="39.3945">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="161.5" y="643.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="171" y="663.3164">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="168.5" y="679.7227">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="246.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="253.5" y="22.9883">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="256.5" y="39.3945">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="246.5" y="643.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="253.5" y="663.3164">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="256.5" y="679.7227">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="363.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="370.5" y="22.9883">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="381.5" y="39.3945">Nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="363.5" y="643.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="370.5" y="663.3164">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="381.5" y="679.7227">Nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="597.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="607" y="22.9883">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="604.5" y="39.3945">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.8125" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="597.5" y="643.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="607" y="663.3164">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="604.5" y="679.7227">contract</text><polygon fill="#A80036" points="392,82.0469,402,86.0469,392,90.0469,396,86.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="199" x2="398" y1="86.0469" y2="86.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="206" y="80.873">New epoch notification</text><path d="M13,101.0469 L136,101.0469 L136,108.0469 L126,118.0469 L13,118.0469 L13,101.0469 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="261.6406" style="stroke: #000000; stroke-width: 2.0;" width="441.5" x="13" y="101.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="28" y="114.1074">1\3 of epoch</text><polygon fill="#A80036" points="298,135.5156,288,139.5156,298,143.5156,294,139.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="292" x2="403" y1="139.5156" y2="139.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="304" y="134.3418">Start estimation</text><polygon fill="#A80036" points="69,164.75,59,168.75,69,172.75,65,168.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="63" x2="286" y1="168.75" y2="168.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="75" y="163.5762">Start estimation notification</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="100" y1="197.9844" y2="197.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="100" x2="100" y1="197.9844" y2="210.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="100" y1="210.9844" y2="210.9844"/><polygon fill="#A80036" points="69,206.9844,59,210.9844,69,214.9844,65,210.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="65" y="192.8105">Exchange estimations</text><polygon fill="#A80036" points="298,264.2188,288,268.2188,298,272.2188,294,268.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="292" x2="403" y1="268.2188" y2="268.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="304" y="263.0449">Stop estimation</text><polygon fill="#A80036" points="69,293.4531,59,297.4531,69,301.4531,65,297.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="63" x2="286" y1="297.4531" y2="297.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="75" y="292.2793">Stop estimation notification</text><polygon fill="#A80036" points="275,322.6875,285,326.6875,275,330.6875,279,326.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="281" y1="326.6875" y2="326.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="65" y="321.5137">Estimate container sizes</text><path d="M236.5,376.6875 L359.5,376.6875 L359.5,383.6875 L349.5,393.6875 L236.5,393.6875 L236.5,376.6875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.7031" style="stroke: #000000; stroke-width: 2.0;" width="446" x="236.5" y="376.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="251.5" y="389.748">2\3 of epoch</text><polygon fill="#A80036" points="298,411.1563,288,415.1563,298,419.1563,294,415.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="292" x2="403" y1="415.1563" y2="415.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="304" y="409.9824">Get estimations</text><polygon fill="#A80036" points="623,440.3906,633,444.3906,623,448.3906,627,444.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="629" y1="444.3906" y2="444.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="411" y="439.2168">Transfer to bank account</text><path d="M353.5,494.3906 L476.5,494.3906 L476.5,501.3906 L466.5,511.3906 L353.5,511.3906 L353.5,494.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.7031" style="stroke: #000000; stroke-width: 2.0;" width="329" x="353.5" y="494.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="368.5" y="507.4512">3\3 of epoch</text><polygon fill="#A80036" points="623,528.8594,633,532.8594,623,536.8594,627,532.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="629" y1="532.8594" y2="532.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="411" y="527.6855">Get balance of bank account</text><polygon fill="#A80036" points="623,558.0938,633,562.0938,623,566.0938,627,562.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="629" y1="562.0938" y2="562.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="411" y="556.9199">Transfer to Storage Node accounts</text><polygon fill="#A80036" points="210,622.3281,200,626.3281,210,630.3281,206,626.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204" x2="403" y1="626.3281" y2="626.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="216" y="621.1543">New epoch</text><!--MD5=[959eb1393b0c9c66c339def6340234ab]
@startuml
participant "Storage\nnodes" as sn
participant "Netmap\ncontract" as netmap
participant "Container\ncontract" as cnr
participant "Inner Ring\nNodes" as ir
participant "Balance\ncontract" as bln

netmap - -> ir: New epoch notification
group 1\3 of epoch
ir -> cnr: Start estimation
cnr - -> sn: Start estimation notification
sn -> sn: Exchange estimations
...
ir -> cnr: Stop estimation
cnr - -> sn: Stop estimation notification
sn -> cnr: Estimate container sizes
...
end

group 2\3 of epoch
ir -> cnr: Get estimations
ir -> bln: Transfer to bank account
...
end

group 3\3 of epoch
ir -> bln: Get balance of bank account
ir -> bln: Transfer to Storage Node accounts
...
end

ir -> netmap: New epoch
@enduml

PlantUML version 1.2020.09(Sun May 10 13:51:06 MSK 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.25+9-suse-150000.3.119.1-x8664
Operating System: Linux
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>