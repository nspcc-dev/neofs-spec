<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="699px" preserveAspectRatio="none" style="width:738px;height:699px;" version="1.1" viewBox="0 0 738 699" width="738px" zoomAndPan="magnify"><defs><filter height="300%" id="f7u31ufo9hs1j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="260.9297" style="stroke: #000000; stroke-width: 2.0;" width="473" x="13" y="100.7266"/><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="476" x="251.5" y="375.6563"/><rect fill="#FFFFFF" filter="url(#f7u31ufo9hs1j)" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="378" y="493.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="54.5938" y2="218.2578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="218.2578" y2="246.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="246.2578" y2="333.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="333.6563" y2="361.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="361.6563" y2="451.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="451.0547" y2="479.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="479.0547" y2="568.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="568.4531" y2="596.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="596.4531" y2="642.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="213.5" x2="213.5" y1="54.5938" y2="218.2578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="213.5" x2="213.5" y1="218.2578" y2="246.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="213.5" x2="213.5" y1="246.2578" y2="333.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="213.5" x2="213.5" y1="333.6563" y2="361.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="213.5" x2="213.5" y1="361.6563" y2="451.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="213.5" x2="213.5" y1="451.0547" y2="479.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="213.5" x2="213.5" y1="479.0547" y2="568.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="213.5" x2="213.5" y1="568.4531" y2="596.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="213.5" x2="213.5" y1="596.4531" y2="642.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="303.5" x2="303.5" y1="54.5938" y2="218.2578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="303.5" x2="303.5" y1="218.2578" y2="246.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="303.5" x2="303.5" y1="246.2578" y2="333.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="303.5" x2="303.5" y1="333.6563" y2="361.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="303.5" x2="303.5" y1="361.6563" y2="451.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="303.5" x2="303.5" y1="451.0547" y2="479.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="303.5" x2="303.5" y1="479.0547" y2="568.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="303.5" x2="303.5" y1="568.4531" y2="596.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="303.5" x2="303.5" y1="596.4531" y2="642.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="432" y1="54.5938" y2="218.2578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="432" x2="432" y1="218.2578" y2="246.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="432" y1="246.2578" y2="333.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="432" x2="432" y1="333.6563" y2="361.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="432" y1="361.6563" y2="451.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="432" x2="432" y1="451.0547" y2="479.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="432" y1="479.0547" y2="568.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="432" x2="432" y1="568.4531" y2="596.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="432" y1="596.4531" y2="642.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679.5" x2="679.5" y1="54.5938" y2="218.2578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="679.5" x2="679.5" y1="218.2578" y2="246.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679.5" x2="679.5" y1="246.2578" y2="333.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="679.5" x2="679.5" y1="333.6563" y2="361.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679.5" x2="679.5" y1="361.6563" y2="451.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="679.5" x2="679.5" y1="451.0547" y2="479.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679.5" x2="679.5" y1="479.0547" y2="568.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="679.5" x2="679.5" y1="568.4531" y2="596.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679.5" x2="679.5" y1="596.4531" y2="642.5859"/><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="22.9951">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="39.292">nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="641.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="661.5811">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="677.8779">nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="176.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="185" y="22.9951">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="183.5" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="176.5" y="641.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="185" y="661.5811">Netmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="183.5" y="677.8779">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="261.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="268.5" y="22.9951">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="273.5" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="261.5" y="641.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="268.5" y="661.5811">Container</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="273.5" y="677.8779">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="388" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="395" y="22.9951">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="407.5" y="39.292">Nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="388" y="641.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="395" y="661.5811">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="407.5" y="677.8779">Nodes</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="642.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="650.5" y="22.9951">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="649.5" y="39.292">contract</text><rect fill="#FEFECE" filter="url(#f7u31ufo9hs1j)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="642.5" y="641.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="650.5" y="661.5811">Balance</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="649.5" y="677.8779">contract</text><polygon fill="#A80036" points="420,81.7266,430,85.7266,420,89.7266,424,85.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="214" x2="426" y1="85.7266" y2="85.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="221" y="80.6606">New epoch notification</text><path d="M13,100.7266 L151,100.7266 L151,107.7266 L141,117.7266 L13,117.7266 L13,100.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.9297" style="stroke: #000000; stroke-width: 2.0;" width="473" x="13" y="100.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="28" y="113.7935">1\3 of epoch</text><polygon fill="#A80036" points="315,134.9922,305,138.9922,315,142.9922,311,138.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309" x2="431" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="321" y="133.9263">Start estimation</text><polygon fill="#A80036" points="70,164.125,60,168.125,70,172.125,66,168.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="303" y1="168.125" y2="168.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="76" y="163.0591">Start estimation notification</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="101" y1="197.2578" y2="197.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="101" y1="197.2578" y2="210.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="101" y1="210.2578" y2="210.2578"/><polygon fill="#A80036" points="70,206.2578,60,210.2578,70,214.2578,66,210.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="66" y="192.1919">Exchange estimations</text><polygon fill="#A80036" points="315,263.3906,305,267.3906,315,271.3906,311,267.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309" x2="431" y1="267.3906" y2="267.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="321" y="262.3247">Stop estimation</text><polygon fill="#A80036" points="70,292.5234,60,296.5234,70,300.5234,66,296.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="303" y1="296.5234" y2="296.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="76" y="291.4575">Stop estimation notification</text><polygon fill="#A80036" points="292,321.6563,302,325.6563,292,329.6563,296,325.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="298" y1="325.6563" y2="325.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="66" y="320.5903">Estimate container sizes</text><path d="M251.5,375.6563 L389.5,375.6563 L389.5,382.6563 L379.5,392.6563 L251.5,392.6563 L251.5,375.6563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="476" x="251.5" y="375.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="266.5" y="388.7231">2\3 of epoch</text><polygon fill="#A80036" points="315,409.9219,305,413.9219,315,417.9219,311,413.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309" x2="431" y1="413.9219" y2="413.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="321" y="408.856">Get estimations</text><polygon fill="#A80036" points="668,439.0547,678,443.0547,668,447.0547,672,443.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="674" y1="443.0547" y2="443.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="439" y="437.9888">Transfer to bank account</text><path d="M378,493.0547 L516,493.0547 L516,500.0547 L506,510.0547 L378,510.0547 L378,493.0547 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="378" y="493.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="393" y="506.1216">3\3 of epoch</text><polygon fill="#A80036" points="668,527.3203,678,531.3203,668,535.3203,672,531.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="674" y1="531.3203" y2="531.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="439" y="526.2544">Get balance of bank account</text><polygon fill="#A80036" points="668,556.4531,678,560.4531,668,564.4531,672,560.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="674" y1="560.4531" y2="560.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="439" y="555.3872">Transfer to Storage Node accounts</text><polygon fill="#A80036" points="225,620.5859,215,624.5859,225,628.5859,221,624.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="219" x2="431" y1="624.5859" y2="624.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="231" y="619.52">New epoch</text><!--
@startuml
participant "Storage\nnodes" as sn
participant "Netmap\ncontract" as netmap
participant "Container\ncontract" as cnr
participant "Inner Ring\nNodes" as ir
participant "Balance\ncontract" as bln

netmap - -> ir: New epoch notification
group 1\3 of epoch
ir -> cnr: Start estimation
cnr - -> sn: Start estimation notification
sn -> sn: Exchange estimations
...
ir -> cnr: Stop estimation
cnr - -> sn: Stop estimation notification
sn -> cnr: Estimate container sizes
...
end

group 2\3 of epoch
ir -> cnr: Get estimations
ir -> bln: Transfer to bank account
...
end

group 3\3 of epoch
ir -> bln: Get balance of bank account
ir -> bln: Transfer to Storage Node accounts
...
end

ir -> netmap: New epoch
@enduml

PlantUML version 1.2018.13(Mon Nov 26 20:11:51 MSK 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-Ubuntu-0ubuntu2.20.04
Operating System: Linux
OS Version: 5.8.0-63-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>